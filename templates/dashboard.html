<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="app-bg">
  <div class="app-screen">

    <!-- HEADER -->
    <div class="app-header">
      <div class="app-title">
        <div class="mini-logo">â‚¹</div>
        <div>
          <h1>Expense Tracker</h1>
          <p>Dashboard</p>
        </div>
      </div>
      <a href="/logout" class="logout-btn">Logout</a>
    </div>

    <!-- TOP CARDS -->
    <div class="cards">
      <div class="card">
        <h3>Total Expense</h3>
        <p>â‚¹{{ total }}</p>
      </div>
      <div class="card">
        <h3>Total Entries</h3>
        <p>{{ expenses | length }}</p>
      </div>
      <div class="card">
        <h3>Status</h3>
        <p>Active</p>
      </div>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="tab-dashboard" class="tab-section active">

      <!-- CHART -->
      <div class="chart-container" style="height:350px; max-width:600px; margin:auto;">
        <h2 style="text-align:center;">Expense Overview</h2>
        <canvas id="expenseChart"></canvas>
      </div>

    </div>

    <!-- ADD EXPENSE TAB -->
    <div id="tab-add" class="tab-section">
      <div class="form-card">
        <h2>Add Expense</h2>

        <form method="POST" action="/add" class="expense-form">
          <label>Name</label>
          <input type="text" name="name" required>

          <label>Category</label>
          <select name="category" required>
            <option value="">Select Category</option>
            <option>Food</option>
            <option>Travel</option>
            <option>Shopping</option>
            <option>Bills</option>
            <option>Other</option>
          </select>

          <label>Amount</label>
          <input type="number" name="amount" required>

          <button type="submit">Add Expense</button>
        </form>

        <button class="voice-btn">ðŸŽ¤ Voice Entry</button>
      </div>
    </div>

    <!-- HISTORY TAB -->
    <div id="tab-history" class="tab-section">
      <h2>Expense History</h2>

      <table class="expense-table">
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Action</th>
        </tr>

        {% for e in expenses %}
        <tr>
          <td>{{ e[0] }}</td>
          <td>{{ e[1] }}</td>
          <td>{{ e[2] }}</td>
          <td>
            <a class="delete-btn" href="/delete/{{ loop.index0 }}">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- TAB BAR -->
    <div class="tabbar">
      <button class="tab active" onclick="openTab(event,'tab-dashboard')">Dashboard</button>
      <button class="tab" onclick="openTab(event,'tab-add')">Add</button>
      <button class="tab" onclick="openTab(event,'tab-history')">History</button>
    </div>

  </div>
</div>

<!-- SCRIPTS -->

<script>
function openTab(evt, tabId) {
  document.querySelectorAll('.tab-section').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  evt.currentTarget.classList.add('active');
}
</script>

<script type="application/json" id="chart-data">
  {{ category_totals | tojson }}
</script>

<script>
const ctx = document.getElementById('expenseChart').getContext('2d');
const data = JSON.parse(document.getElementById('chart-data').textContent);

new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: Object.keys(data),
    datasets: [{
      data: Object.values(data),
      backgroundColor: [
        '#4e73df',
        '#1cc88a',
        '#36b9cc',
        '#f6c23e',
        '#e74a3b'
      ]
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom'
      }
    }
  }
});
</script>

</body>
</html>
